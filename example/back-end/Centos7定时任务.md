---
title: Centos7定时任务
date: 2021-03-09
categories:
 - 后端
tags:
 - Centos
---

## Centos7定时任务

### 需求

服务器需要隔一段时间将服务器的时间重置为某个日期

### 实现方法

#### 基础知识

`crontab`命令：是centos上指定定时任务的脚本，依赖于`crond`服务

`crond`服务：执行定时任务的服务，系统启动就会存在



**`crontab`命令常用功能**

| 选项    | 功能                                                         |
| ------- | ------------------------------------------------------------ |
| -u user | 用来设定某个用户的 crontab 服务，例如 "-u demo" 表示设备 demo 用户的 crontab 服务，此选项一般有 root 用户来运行。 |
| -e      | 编辑某个用户的 crontab 文件内容。如果不指定用户，则表示编辑当前用户的 crontab 文件。 |
| -l      | 显示某用户的 crontab 文件内容，如果不指定用户，则表示显示当前用户的 crontab 文件内容。 |
| -r      | 从 /var/spool/cron 删除某用户的 crontab 文件，如果不指定用户，则默认删除当前用户的 crontab 文件。 |
| -i      | 在删除用户的 crontab 文件时，给确认提示。                    |



**`crontab`任务格式**

```shell
[root@localhost ！]# crontab -e
#进入 crontab 编辑界面。会打开Vim编辑你的任务
* * * * * 执行的任务
```



**星号的含义**

| 项目      | 含义                           | 范围                    |
| --------- | ------------------------------ | ----------------------- |
| 第一个"*" | 一小时当中的第几分钟（minute） | 0~59                    |
| 第二个"*" | 一天当中的第几小时（hour）     | 0~23                    |
| 第三个"*" | 一个月当中的第几天（day）      | 1~31                    |
| 第四个"*" | 一年当中的第几个月（month）    | 1~12                    |
| 第五个"*" | 一周当中的星期几（week）       | 0~7（0和7都代表星期日） |



**时间特殊符号**

| 特殊符号    | 含义                                                         |
| ----------- | ------------------------------------------------------------ |
| *（星号）   | 代表任何时间。比如第一个"*"就代表一小时种每分钟都执行一次的意思。 |
| ,（逗号）   | 代表不连续的时间。比如"0 8，12，16***命令"就代表在每天的 8 点 0 分、12 点 0 分、16 点 0 分都执行一次命令。 |
| -（中杠）   | 代表连续的时间范围。比如"0 5 ** 1-6命令"，代表在周一到周六的凌晨 5 点 0 分执行命令。 |
| /（正斜线） | 代表每隔多久执行一次。比如"*/10****命令"，代表每隔 10 分钟就执行一次命令。 |



**任务举例**

| 时间              | 含义                                                         |
| ----------------- | ------------------------------------------------------------ |
| 45 22 ***命令     | 在 22 点 45 分执行命令                                       |
| 0 17 ** 1命令     | 在每周一的 17 点 0 分执行命令                                |
| 0 5 1，15**命令   | 在每月 1 日和 15 日的凌晨 5 点 0 分执行命令                  |
| 40 4 ** 1-5命令   | 在每周一到周五的凌晨 4 点 40 分执行命令                      |
| */10 4 ***命令    | 在每天的凌晨 4 点，每隔 10 分钟执行一次命令                  |
| 0 0 1，15 * 1命令 | 在每月 1 日和 15 日，每周一个 0 点 0 分都会执行命令，注意：星期几和几日最好不要同时出现，因为它们定义的都是天，非常容易让管理员混淆 |



#### 举例实践

先进行测试，每分钟定时访问我本地的程序

```shell
[root@localhost ！]# crontab -e
#进入 crontab 编辑界面。会打开Vim编辑你的任务
* * * * * wget http://172.xx.xx.1:8080
```

之后每一分钟，我本地程序会被访问一次，说明可行



设置服务器时间，每个月28号重置服务器时间

```shell
[root@localhost ！]# crontab -e
#进入 crontab 编辑界面。会打开Vim编辑你的任务
0 5 28 * * timedatectl set-time "2021-03-09 05:00:00"
0 5 28 * * date -s "2021-03-09 05:00:00"
```



#### 可能遇到的问题

```shell
[root@localhost ~]# crontab -l
no crontab for root
#删除后，再查询就没有root用户的定时任务了，这个不是报错，正常现象
```

```shell
[root@localhost ~]# timedatectl set-time "2021-03-09 05:00:00"
Failed to set time: Automatic time synchronization is enabled
# 执行 timedatectl set-ntp no
```



### 参考资料

http://c.biancheng.net/view/1092.html